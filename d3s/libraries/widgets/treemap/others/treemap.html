
<!-- saved from url=(0055)http://mbostock.github.io/d3/talk/20111018/treemap.html -->
<html><body><div class="webkit-line-gutter-backdrop"></div><table><tbody><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-doctype">&lt;!DOCTYPE html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;meta <span class="webkit-html-attribute-name">http-equiv</span>="<span class="webkit-html-attribute-value">Content-Type</span>" <span class="webkit-html-attribute-name">content</span>="<span class="webkit-html-attribute-value">text/html;charset=utf-8</span>"/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;link <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/css</span>" <span class="webkit-html-attribute-name">rel</span>="<span class="webkit-html-attribute-value">stylesheet</span>" <span class="webkit-html-attribute-name">href</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://mbostock.github.io/d3/talk/20111018/style.css">style.css</a>"/&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>" <span class="webkit-html-attribute-name">src</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://mbostock.github.io/d3/talk/20111018/d3/d3.js">d3/d3.js</a>"&gt;</span><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>" <span class="webkit-html-attribute-name">src</span>="<a class="webkit-html-attribute-value webkit-html-resource-link" target="_blank" href="http://mbostock.github.io/d3/talk/20111018/d3/d3.layout.js">d3/d3.layout.js</a>"&gt;</span><span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;style <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/css</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">.chart {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  display: block;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  margin: auto;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  margin-top: 40px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">text {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  font-size: 11px;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">rect {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  fill: none;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/style&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;/head&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;body&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">body</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">id</span>="<span class="webkit-html-attribute-value">footer</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        d3.layout.treemap</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;div <span class="webkit-html-attribute-name">class</span>="<span class="webkit-html-attribute-value">hint</span>"&gt;</span>click or option-click to descend or ascend<span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;div&gt;</span><span class="webkit-html-tag">&lt;select&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          <span class="webkit-html-tag">&lt;option <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">size</span>"&gt;</span>Size<span class="webkit-html-tag">&lt;/option&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">          <span class="webkit-html-tag">&lt;option <span class="webkit-html-attribute-name">value</span>="<span class="webkit-html-attribute-value">count</span>"&gt;</span>Count<span class="webkit-html-tag">&lt;/option&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">        <span class="webkit-html-tag">&lt;/select&gt;</span><span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      <span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/div&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;script <span class="webkit-html-attribute-name">type</span>="<span class="webkit-html-attribute-value">text/javascript</span>"&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var w = 1280 - 80,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    h = 800 - 180,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    x = d3.scale.linear().range([0, w]),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    y = d3.scale.linear().range([0, h]),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    color = d3.scale.category20c(),</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    root,</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    node;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var treemap = d3.layout.treemap()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .round(false)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .size([w, h])</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .sticky(true)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .value(function(d) { return d.size; });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">var svg = d3.select("#body").append("div")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .attr("class", "chart")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .style("width", w + "px")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .style("height", h + "px")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  .append("svg:svg")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .attr("width", w)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .attr("height", h)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  .append("svg:g")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .attr("transform", "translate(.5,.5)");</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">d3.json("flare.json", function(data) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  node = root = data;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  var nodes = treemap.nodes(root)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .filter(function(d) { return !d.children; });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  var cell = svg.selectAll("g")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .data(nodes)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    .enter().append("svg:g")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("class", "cell")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("transform", function(d) { return "translate(" + d.x + "," + d.y + ")"; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .on("click", function(d) { return zoom(node == d.parent ? root : d.parent); });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  cell.append("svg:rect")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("width", function(d) { return d.dx - 1; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("height", function(d) { return d.dy - 1; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .style("fill", function(d) { return color(d.parent.name); });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  cell.append("svg:text")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("x", function(d) { return d.dx / 2; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("y", function(d) { return d.dy / 2; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("dy", ".35em")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("text-anchor", "middle")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .text(function(d) { return d.name; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .style("opacity", function(d) { d.w = this.getComputedTextLength(); return d.dx &gt; d.w ? 1 : 0; });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  d3.select(window).on("click", function() { zoom(root); });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  d3.select("select").on("change", function() {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    treemap.value(this.value == "size" ? size : count).nodes(root);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    zoom(node);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">});</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function size(d) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  return d.size;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function count(d) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  return 1;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">function zoom(d) {</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  var kx = w / d.dx, ky = h / d.dy;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  x.domain([d.x, d.x + d.dx]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  y.domain([d.y, d.y + d.dy]);</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  var t = svg.selectAll("g.cell").transition()</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .duration(d3.event.altKey ? 7500 : 750)</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("transform", function(d) { return "translate(" + x(d.x) + "," + y(d.y) + ")"; });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  t.select("rect")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("width", function(d) { return kx * d.dx - 1; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("height", function(d) { return ky * d.dy - 1; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  t.select("text")</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("x", function(d) { return kx * d.dx / 2; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .attr("y", function(d) { return ky * d.dy / 2; })</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">      .style("opacity", function(d) { return kx * d.dx &gt; d.w ? 1 : 0; });</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  node = d;</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  d3.event.stopPropagation();</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">}</td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><br></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">    <span class="webkit-html-tag">&lt;/script&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content">  <span class="webkit-html-tag">&lt;/body&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"><span class="webkit-html-tag">&lt;/html&gt;</span></td></tr><tr><td class="webkit-line-number"></td><td class="webkit-line-content"></td></tr></tbody></table></body></html>